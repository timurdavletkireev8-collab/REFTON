<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background-color: #000; 
            color: #fff; 
            font-family: sans-serif; 
        }
        /* Управление вкладками */
        .tab-content { 
            display: none; 
        }
        .tab-content.active { 
            display: block; 
        }
        /* Стили для модального окна */
        .modal { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.8); 
            align-items: center; 
            justify-content: center; 
            z-index: 50; 
        }
        .modal.active { 
            display: flex; 
        }
    </style>
</head>
<body>

    <div id="app" class="pb-20">
        
        <div id="profile" class="tab-content active p-6 text-center">
            <h1 class="text-2xl font-bold mb-4">Profile</h1>
            
            <div class="bg-gray-900 rounded-3xl p-8 mb-6 flex flex-col items-center">
                <p class="text-gray-400 mb-2">Ваш баланс</p>
                <h2 id="balance-display" class="text-4xl font-extrabold mb-6">0.00 TON</h2>
                
                <button onclick="openWalletModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full transition-all w-full max-w-[250px]">
                    Привязать кошелёк
                </button>
                <p id="wallet-status" class="mt-4 text-sm text-green-400 hidden">Кошелёк подключен: <span id="addr-preview"></span></p>
            </div>

            <div class="space-y-4 text-left">
                <div class="bg-gray-800 p-4 rounded-xl flex justify-between items-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <span>Статистика</span>
                    <span class="text-blue-400">→</span>
                </div>
                <div class="bg-gray-800 p-4 rounded-xl flex justify-between items-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <span>Настройки</span>
                    <span class="text-blue-400">→</span>
                </div>
            </div>
        </div>

        <div id="tasks" class="tab-content p-6">
            <h1 class="text-2xl font-bold mb-4">Задания</h1>
            <div class="bg-gray-900 rounded-2xl p-4 text-center text-gray-400">
                Здесь будет список заданий
            </div>
        </div>
    </div>

    <div id="wallet-modal" class="modal">
        <div class="bg-gray-900 p-6 rounded-2xl w-80 border border-gray-700">
            <h3 class="text-xl font-bold mb-4 text-center">Выберите кошелёк</h3>
            <div class="space-y-3">
                <button onclick="connectWallet('Tonkeeper')" class="w-full bg-gray-800 p-3 rounded-lg flex items-center gap-3 hover:bg-gray-700 transition-colors">
                    <div class="w-8 h-8 bg-blue-500 rounded-full"></div> Tonkeeper
                </button>
                <button onclick="connectWallet('MyTonWallet')" class="w-full bg-gray-800 p-3 rounded-lg flex items-center gap-3 hover:bg-gray-700 transition-colors">
                    <div class="w-8 h-8 bg-blue-400 rounded-full"></div> MyTonWallet
                </button>
                <button onclick="connectWallet('Telegram Wallet')" class="w-full bg-gray-800 p-3 rounded-lg flex items-center gap-3 hover:bg-gray-700 transition-colors">
                    <div class="w-8 h-8 bg-blue-300 rounded-full"></div> Telegram Wallet
                </button>
            </div>
            <button onclick="closeWalletModal()" class="mt-4 w-full text-gray-400 text-sm hover:text-white transition-colors">Отмена</button>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 flex justify-around p-4 z-40">
        <button onclick="showTab('tasks')" class="flex flex-col items-center text-gray-400 hover:text-blue-500 transition-colors">
            <span class="text-sm font-medium">Tasks</span>
        </button>
        <button onclick="showTab('profile')" class="flex flex-col items-center text-blue-500 hover:text-blue-400 transition-colors">
            <span class="text-sm font-medium">Profile</span>
        </button>
    </nav>

    <script>
        // --- БАЗА ДАННЫХ ---
        const DB = {
            // Ключ для хранения данных в браузере
            STORAGE_KEY: 'user_app_data',

            // Сохранение всей "таблицы" пользователя
            save(data) {
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
            },

            // Загрузка данных
            load() {
                const data = localStorage.getItem(this.STORAGE_KEY);
                return data ? JSON.parse(data) : null;
            },

            // Инициализация (создание записи, если её нет)
            init() {
                let user = this.load();
                if (!user) {
                    user = {
                        balance: 500.00, // Начальное значение для проверки
                        wallet: null,
                        connected: false
                    };
                    this.save(user);
                }
                return user;
            },

            // Обновление конкретного поля (баланс, кошелек и т.д.)
            update(fields) {
                const current = this.init();
                const updated = { ...current, ...fields };
                this.save(updated);
                return updated;
            }
        };

        // --- ФУНКЦИИ ИНТЕРФЕЙСА ---

        function initApp() {
            const user = DB.init();
            renderUI(user);
        }

        // Рендерим данные из БД на экран
        function renderUI(user) {
            document.getElementById('balance-display').innerText = `${user.balance.toFixed(2)} TON`;
            
            if (user.connected && user.wallet) {
                const status = document.getElementById('wallet-status');
                const preview = document.getElementById('addr-preview');
                status.classList.remove('hidden');
                preview.innerText = user.wallet;
                // Можно скрыть кнопку, если кошелек уже привязан
                // document.querySelector('button[onclick="openWalletModal()"]').style.display = 'none';
            }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            const navButtons = document.querySelectorAll('nav button');
            navButtons.forEach(btn => btn.classList.replace('text-blue-500', 'text-gray-400'));
            event.currentTarget.classList.replace('text-gray-400', 'text-blue-500');
        }

        function openWalletModal() {
            document.getElementById('wallet-modal').classList.add('active');
        }

        function closeWalletModal() {
            document.getElementById('wallet-modal').classList.remove('active');
        }

        function connectWallet(walletName) {
            // Записываем в БД через метод update
            const updatedUser = DB.update({
                wallet: walletName,
                connected: true
            });

            // Сразу отображаем изменения
            renderUI(updatedUser);
            closeWalletModal();
            alert("Данные успешно сохранены в базе!");
        }

        // Запуск при старте
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
